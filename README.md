```markdown
# jacoco-enhanced  
A Jacoco-based enhanced tool supporting IP-based coverage splitting, incremental statistics, multi-version probe merging, and more.  

åŸºäº Jacoco äºŒæ¬¡å¼€å‘çš„å¢å¼ºå·¥å…·ï¼Œæ”¯æŒæŒ‰IPåˆ’åˆ†è¦†ç›–ç‡ã€å¢é‡ç»Ÿè®¡ã€å¤šç‰ˆæœ¬æ¢é’ˆæ•°æ®åˆå¹¶ç­‰åŠŸèƒ½ã€‚  


## ğŸŒŸ Core Enhanced Features  
- **IP/Custom Rule Coverage Splitting**: Split coverage data by requester IP or business rules for scenario-specific analysis.  
- **Incremental Coverage Statistics**: Calculate coverage only for changed code via diff data (works with [code-diff](https://gitee.com/Dray/code-diff) for diff files).  
- **Multi-version Exec Merging**: Merge multiple Jacoco exec files to generate unified cross-version coverage data.  
- **Precise Branch Coverage**: Optimized branch coverage marking for more accurate code branch execution recognition.  
- **Reflection Data Filtering**: Automatically filter JacocoData obtained via reflection to avoid coverage result interference.  

## ğŸŒŸ æ ¸å¿ƒå¢å¼ºåŠŸèƒ½  
- **IP/è‡ªå®šä¹‰è§„åˆ™æ‹†åˆ†è¦†ç›–ç‡**ï¼šæŒ‰è¯·æ±‚è€…IPæˆ–ä¸šåŠ¡è§„åˆ™åˆ’åˆ†è¦†ç›–ç‡æ•°æ®ï¼Œç²¾å‡†å®šä½ä¸åŒåœºæ™¯çš„è¦†ç›–æƒ…å†µã€‚  
- **å¢é‡è¦†ç›–ç‡ç»Ÿè®¡**ï¼šé€šè¿‡ä»£ç å·®å¼‚æ•°æ®ï¼Œä»…ç»Ÿè®¡æŒ‡å®šå¢é‡ä»£ç çš„è¦†ç›–ç‡ï¼ˆéœ€é…åˆ[code-diff](https://gitee.com/Dray/code-diff)ç”Ÿæˆå·®å¼‚æ–‡ä»¶ï¼‰ã€‚  
- **å¤šç‰ˆæœ¬æ¢é’ˆåˆå¹¶**ï¼šæ”¯æŒåˆå¹¶å¤šä¸ªJacoco execæ–‡ä»¶ï¼Œç”Ÿæˆè·¨ç‰ˆæœ¬çš„ç»Ÿä¸€è¦†ç›–ç‡æ•°æ®ã€‚  
- **ç²¾ç¡®åˆ†æ”¯è¦†ç›–**ï¼šä¼˜åŒ–åˆ†æ”¯è¦†ç›–æ ‡è®°é€»è¾‘ï¼Œæ›´å‡†ç¡®åœ°è¯†åˆ«ä»£ç åˆ†æ”¯çš„æ‰§è¡Œæƒ…å†µã€‚  
- **åå°„æ•°æ®è¿‡æ»¤**ï¼šè‡ªåŠ¨è¿‡æ»¤é€šè¿‡åå°„è·å–çš„JacocoDataï¼Œé¿å…å¹²æ‰°è¦†ç›–ç‡ç»Ÿè®¡ç»“æœã€‚  


## ğŸ“¥ Quick Access  
No need to compileâ€”use directly:  
Download pre-packaged `agent` and `cli` packages from [Releases](https://github.com/your-username/jacoco-enhanced/releases).  

## ğŸ“¥ å¿«é€Ÿè·å–  
æ— éœ€ç¼–è¯‘å¯ç›´æ¥ä½¿ç”¨ï¼š  
ä» [Releases](https://github.com/ä½ çš„ç”¨æˆ·å/jacoco-enhanced/releases) ä¸‹è½½å·²æ‰“åŒ…çš„ `agentåŒ…` å’Œ `cliåŒ…`ã€‚  


## ğŸ”¨ Compilation Guide  
To modify the source code, compile with Maven:  
```bash
mvn clean install -Dmaven.test.skip=true -Dmaven.javadoc.skip=true
```  

## ğŸ”¨ ç¼–è¯‘æ–¹æ³•  
è‹¥éœ€è‡ªå®šä¹‰ä¿®æ”¹æºç ï¼Œæ‰§è¡Œä»¥ä¸‹Mavenå‘½ä»¤ç¼–è¯‘ï¼š  
```bash
mvn clean install -Dmaven.test.skip=true -Dmaven.javadoc.skip=true
```  


## ğŸ“š Usage Guide  

### Core Parameters  
| Parameter             | Description                                                                 |
|-----------------------|-----------------------------------------------------------------------------|
| `--diffcode`          | Enable incremental coverage statistics (full coverage by default).          |
| `--diffCodeFiles`     | Path to code diff file (JSON generated by code-diff).                       |
| `--onlyMergeExec`     | Merge exec files only without generating reports (set to `true` to enable). |
| `--mergeExecfilepath` | Paths to exec files to merge (multiple paths separated by spaces).          |
| `--mergeClassfilepath`| Class file paths corresponding to merged exec files (match exec versions).  |
| `--mergeExec`         | Path for the merged exec file output.                                       |
| `--classfiles`        | Target class file directories (multiple allowed).                           |
| `--sourcefiles`       | Source code directories (for source-linked reports).                        |
| `--html`              | Output directory for HTML reports.                                          |

### æ ¸å¿ƒå‚æ•°è¯´æ˜  
| å‚æ•°                | ä½œç”¨æè¿°                                                                 |
|---------------------|--------------------------------------------------------------------------|
| `--diffcode`        | å¯ç”¨å¢é‡è¦†ç›–ç‡ç»Ÿè®¡ï¼ˆé»˜è®¤å…¨é‡ç»Ÿè®¡ï¼‰                                       |
| `--diffCodeFiles`   | ä»£ç å·®å¼‚æ–‡ä»¶è·¯å¾„ï¼ˆç”±code-diffç”Ÿæˆçš„JSONæ–‡ä»¶ï¼‰                            |
| `--onlyMergeExec`   | ä»…åˆå¹¶execæ–‡ä»¶ï¼Œä¸ç”ŸæˆæŠ¥å‘Šï¼ˆå€¼ä¸º`true`æ—¶ç”Ÿæ•ˆï¼‰                           |
| `--mergeExecfilepath` | éœ€è¦åˆå¹¶çš„execæ–‡ä»¶è·¯å¾„ï¼ˆå¯æŒ‡å®šå¤šä¸ªï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼‰                         |
| `--mergeClassfilepath` | å¯¹åº”åˆå¹¶execçš„classæ–‡ä»¶è·¯å¾„ï¼ˆéœ€ä¸execç‰ˆæœ¬åŒ¹é…ï¼Œå¯æŒ‡å®šå¤šä¸ªï¼‰              |
| `--mergeExec`       | åˆå¹¶åç”Ÿæˆçš„execæ–‡ä»¶è·¯å¾„                                                 |
| `--classfiles`      | ç›®æ ‡classæ–‡ä»¶ç›®å½•ï¼ˆå¯æŒ‡å®šå¤šä¸ªï¼‰                                          |
| `--sourcefiles`     | æºä»£ç ç›®å½•ï¼ˆç”¨äºç”Ÿæˆå¸¦æºç çš„æŠ¥å‘Šï¼‰                                       |
| `--html`            | HTMLæŠ¥å‘Šè¾“å‡ºç›®å½•                                                         |


### Command Line Examples  

#### 1. Generate Incremental Coverage Report  
```bash
java -jar org.jacoco.cli-0.8.7-SNAPSHOT-nodeps.jar report \
  /path/to/current.exec \
  --classfiles /path/to/target/classes \
  --mergeExecfilepath /path/to/history.exec \
  --mergeClassfilepath /path/to/history/classes \
  --diffCodeFiles /path/to/diff.json \
  --sourcefiles /path/to/src/main/java \
  --html /path/to/increment-report
```

#### 2. Merge Multiple Exec Files  
```bash
java -jar org.jacoco.cli-0.8.7-SNAPSHOT-nodeps.jar report \
  /path/to/first.exec \
  --classfiles /path/to/current/classes \
  --mergeExecfilepath /path/to/second.exec \
  --mergeClassfilepath /path/to/second/classes \
  --onlyMergeExec true \
  --mergeExec /path/to/merged.exec
```

### å‘½ä»¤è¡Œç¤ºä¾‹  

#### 1. ç”Ÿæˆå¢é‡è¦†ç›–ç‡æŠ¥å‘Š  
```bash
java -jar org.jacoco.cli-0.8.7-SNAPSHOT-nodeps.jar report \
  /path/to/current.exec \
  --classfiles /path/to/target/classes \
  --mergeExecfilepath /path/to/history.exec \
  --mergeClassfilepath /path/to/history/classes \
  --diffCodeFiles /path/to/diff.json \
  --sourcefiles /path/to/src/main/java \
  --html /path/to/increment-report
```

#### 2. åˆå¹¶å¤šä¸ªexecæ–‡ä»¶  
```bash
java -jar org.jacoco.cli-0.8.7-SNAPSHOT-nodeps.jar report \
  /path/to/first.exec \
  --classfiles /path/to/current/classes \
  --mergeExecfilepath /path/to/second.exec \
  --mergeClassfilepath /path/to/second/classes \
  --onlyMergeExec true \
  --mergeExec /path/to/merged.exec
```


### Code Integration Example  
After adding the CLI dependency, execute via code:  
```java
File reportDir = new File("/path/to/report");
new Main().execute("report", 
  "/path/to/base.exec",
  "--classfiles", "/path/to/classes",
  "--mergeExecfilepath", "/path/to/old.exec",
  "--mergeClassfilepath", "/path/to/old/classes",
  "--sourcefiles", "/path/to/src",
  "--html", reportDir.getAbsolutePath()
);
```

### ä»£ç è°ƒç”¨ç¤ºä¾‹  
åœ¨é¡¹ç›®ä¸­å¼•å…¥CLIä¾èµ–åï¼Œé€šè¿‡ä»£ç æ‰§è¡Œï¼š  
```java
File reportDir = new File("/path/to/report");
new Main().execute("report", 
  "/path/to/base.exec",
  "--classfiles", "/path/to/classes",
  "--mergeExecfilepath", "/path/to/old.exec",
  "--mergeClassfilepath", "/path/to/old/classes",
  "--sourcefiles", "/path/to/src",
  "--html", reportDir.getAbsolutePath()
);
```


## ğŸ“Œ Notes  
- For multi-round merging: Set `mergeClassfilepath` to the class path of the latest version in each merge (e.g., when merging AB.exec + C.exec, use B's class path).  
- Requires JDK 1.8 environment.  

## ğŸ“Œ æ³¨æ„äº‹é¡¹  
- å¤šè½®åˆå¹¶æ—¶ï¼Œ`mergeClassfilepath`éœ€æŒ‡å®šä¸Šä¸€æ¬¡åˆå¹¶çš„classè·¯å¾„ï¼ˆå¦‚åˆå¹¶A.exec+B.execâ†’AB.execåï¼Œå†åˆå¹¶AB.exec+C.execæ—¶ï¼Œ`mergeClassfilepath`åº”ä¸ºBçš„classè·¯å¾„ï¼‰ã€‚  
- ä¾èµ–JDK 1.8ç¯å¢ƒè¿è¡Œã€‚  


## ğŸ¤ Feedback & Support  
For issues or questions:  
- Submit an [Issue](https://github.com/chen524266/jacoco-enhanced/issues)  
- Join the WeChat group: [Scan QR Code](link-or-qr-placeholder)  

## ğŸ¤ äº¤æµä¸åé¦ˆ  
ä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼äº¤æµï¼š  
- æäº¤ [Issue](https://github.com/chen524266/jacoco-enhanced/issues)  
- åŠ å…¥å¾®ä¿¡ç¾¤ï¼š[æ‰«ç è¿›ç¾¤](é“¾æ¥æˆ–äºŒç»´ç å ä½ç¬¦)  
<img width="599" height="597" alt="image" src="https://github.com/user-attachments/assets/c9725607-c9cd-4a9b-9727-20d3d09768f2" />
## ğŸ“„ License  
- Core functionality is based on [Jacoco](https://www.jacoco.org/jacoco/) (EPL-2.0 License).  
- Closed-source features (e.g., IP splitting) require a paid license. Open-source components follow EPL-2.0.  

## ğŸ“„ è®¸å¯è¯  
- æœ¬é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½åŸºäº [Jacoco](https://www.jacoco.org/jacoco/)ï¼ˆEPL-2.0è®¸å¯è¯ï¼‰äºŒæ¬¡å¼€å‘ã€‚  
- æ–°å¢é—­æºåŠŸèƒ½ï¼ˆå¦‚IPåˆ’åˆ†ç­‰ï¼‰éœ€ä»˜è´¹æˆæƒï¼Œå¼€æºéƒ¨åˆ†éµå¾ªEPL-2.0è®¸å¯è¯ã€‚  
```
