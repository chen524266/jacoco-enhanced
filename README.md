```markdown
# jacoco-enhanced  
A Jacoco-based enhanced tool supporting IP-based coverage splitting, incremental statistics, multi-version probe merging, and more.  

基于 Jacoco 二次开发的增强工具，支持按IP划分覆盖率、增量统计、多版本探针数据合并等功能。  


## 🌟 Core Enhanced Features  
- **IP/Custom Rule Coverage Splitting**: Split coverage data by requester IP or business rules for scenario-specific analysis.  
- **Incremental Coverage Statistics**: Calculate coverage only for changed code via diff data (works with [code-diff](https://gitee.com/Dray/code-diff) for diff files).  
- **Multi-version Exec Merging**: Merge multiple Jacoco exec files to generate unified cross-version coverage data.  
- **Precise Branch Coverage**: Optimized branch coverage marking for more accurate code branch execution recognition.  
- **Reflection Data Filtering**: Automatically filter JacocoData obtained via reflection to avoid coverage result interference.  

## 🌟 核心增强功能  
- **IP/自定义规则拆分覆盖率**：按请求者IP或业务规则划分覆盖率数据，精准定位不同场景的覆盖情况。  
- **增量覆盖率统计**：通过代码差异数据，仅统计指定增量代码的覆盖率（需配合[code-diff](https://gitee.com/Dray/code-diff)生成差异文件）。  
- **多版本探针合并**：支持合并多个Jacoco exec文件，生成跨版本的统一覆盖率数据。  
- **精确分支覆盖**：优化分支覆盖标记逻辑，更准确地识别代码分支的执行情况。  
- **反射数据过滤**：自动过滤通过反射获取的JacocoData，避免干扰覆盖率统计结果。  


## 📥 Quick Access  
No need to compile—use directly:  
Download pre-packaged `agent` and `cli` packages from [Releases](https://github.com/your-username/jacoco-enhanced/releases).  

## 📥 快速获取  
无需编译可直接使用：  
从 [Releases](https://github.com/你的用户名/jacoco-enhanced/releases) 下载已打包的 `agent包` 和 `cli包`。  


## 🔨 Compilation Guide  
To modify the source code, compile with Maven:  
```bash
mvn clean install -Dmaven.test.skip=true -Dmaven.javadoc.skip=true
```  

## 🔨 编译方法  
若需自定义修改源码，执行以下Maven命令编译：  
```bash
mvn clean install -Dmaven.test.skip=true -Dmaven.javadoc.skip=true
```  


## 📚 Usage Guide  

### Core Parameters  
| Parameter             | Description                                                                 |
|-----------------------|-----------------------------------------------------------------------------|
| `--diffcode`          | Enable incremental coverage statistics (full coverage by default).          |
| `--diffCodeFiles`     | Path to code diff file (JSON generated by code-diff).                       |
| `--onlyMergeExec`     | Merge exec files only without generating reports (set to `true` to enable). |
| `--mergeExecfilepath` | Paths to exec files to merge (multiple paths separated by spaces).          |
| `--mergeClassfilepath`| Class file paths corresponding to merged exec files (match exec versions).  |
| `--mergeExec`         | Path for the merged exec file output.                                       |
| `--classfiles`        | Target class file directories (multiple allowed).                           |
| `--sourcefiles`       | Source code directories (for source-linked reports).                        |
| `--html`              | Output directory for HTML reports.                                          |

### 核心参数说明  
| 参数                | 作用描述                                                                 |
|---------------------|--------------------------------------------------------------------------|
| `--diffcode`        | 启用增量覆盖率统计（默认全量统计）                                       |
| `--diffCodeFiles`   | 代码差异文件路径（由code-diff生成的JSON文件）                            |
| `--onlyMergeExec`   | 仅合并exec文件，不生成报告（值为`true`时生效）                           |
| `--mergeExecfilepath` | 需要合并的exec文件路径（可指定多个，用空格分隔）                         |
| `--mergeClassfilepath` | 对应合并exec的class文件路径（需与exec版本匹配，可指定多个）              |
| `--mergeExec`       | 合并后生成的exec文件路径                                                 |
| `--classfiles`      | 目标class文件目录（可指定多个）                                          |
| `--sourcefiles`     | 源代码目录（用于生成带源码的报告）                                       |
| `--html`            | HTML报告输出目录                                                         |


### Command Line Examples  

#### 1. Generate Incremental Coverage Report  
```bash
java -jar org.jacoco.cli-0.8.7-SNAPSHOT-nodeps.jar report \
  /path/to/current.exec \
  --classfiles /path/to/target/classes \
  --mergeExecfilepath /path/to/history.exec \
  --mergeClassfilepath /path/to/history/classes \
  --diffCodeFiles /path/to/diff.json \
  --sourcefiles /path/to/src/main/java \
  --html /path/to/increment-report
```

#### 2. Merge Multiple Exec Files  
```bash
java -jar org.jacoco.cli-0.8.7-SNAPSHOT-nodeps.jar report \
  /path/to/first.exec \
  --classfiles /path/to/current/classes \
  --mergeExecfilepath /path/to/second.exec \
  --mergeClassfilepath /path/to/second/classes \
  --onlyMergeExec true \
  --mergeExec /path/to/merged.exec
```

### 命令行示例  

#### 1. 生成增量覆盖率报告  
```bash
java -jar org.jacoco.cli-0.8.7-SNAPSHOT-nodeps.jar report \
  /path/to/current.exec \
  --classfiles /path/to/target/classes \
  --mergeExecfilepath /path/to/history.exec \
  --mergeClassfilepath /path/to/history/classes \
  --diffCodeFiles /path/to/diff.json \
  --sourcefiles /path/to/src/main/java \
  --html /path/to/increment-report
```

#### 2. 合并多个exec文件  
```bash
java -jar org.jacoco.cli-0.8.7-SNAPSHOT-nodeps.jar report \
  /path/to/first.exec \
  --classfiles /path/to/current/classes \
  --mergeExecfilepath /path/to/second.exec \
  --mergeClassfilepath /path/to/second/classes \
  --onlyMergeExec true \
  --mergeExec /path/to/merged.exec
```


### Code Integration Example  
After adding the CLI dependency, execute via code:  
```java
File reportDir = new File("/path/to/report");
new Main().execute("report", 
  "/path/to/base.exec",
  "--classfiles", "/path/to/classes",
  "--mergeExecfilepath", "/path/to/old.exec",
  "--mergeClassfilepath", "/path/to/old/classes",
  "--sourcefiles", "/path/to/src",
  "--html", reportDir.getAbsolutePath()
);
```

### 代码调用示例  
在项目中引入CLI依赖后，通过代码执行：  
```java
File reportDir = new File("/path/to/report");
new Main().execute("report", 
  "/path/to/base.exec",
  "--classfiles", "/path/to/classes",
  "--mergeExecfilepath", "/path/to/old.exec",
  "--mergeClassfilepath", "/path/to/old/classes",
  "--sourcefiles", "/path/to/src",
  "--html", reportDir.getAbsolutePath()
);
```


## 📌 Notes  
- For multi-round merging: Set `mergeClassfilepath` to the class path of the latest version in each merge (e.g., when merging AB.exec + C.exec, use B's class path).  
- Requires JDK 1.8 environment.  

## 📌 注意事项  
- 多轮合并时，`mergeClassfilepath`需指定上一次合并的class路径（如合并A.exec+B.exec→AB.exec后，再合并AB.exec+C.exec时，`mergeClassfilepath`应为B的class路径）。  
- 依赖JDK 1.8环境运行。  


## 🤝 Feedback & Support  
For issues or questions:  
- Submit an [Issue](https://github.com/chen524266/jacoco-enhanced/issues)  
- Join the WeChat group: [Scan QR Code](link-or-qr-placeholder)  

## 🤝 交流与反馈  
使用中遇到问题可通过以下方式交流：  
- 提交 [Issue](https://github.com/chen524266/jacoco-enhanced/issues)  
- 加入微信群：[扫码进群](链接或二维码占位符)  
<img width="599" height="597" alt="image" src="https://github.com/user-attachments/assets/c9725607-c9cd-4a9b-9727-20d3d09768f2" />
## 📄 License  
- Core functionality is based on [Jacoco](https://www.jacoco.org/jacoco/) (EPL-2.0 License).  
- Closed-source features (e.g., IP splitting) require a paid license. Open-source components follow EPL-2.0.  

## 📄 许可证  
- 本项目核心功能基于 [Jacoco](https://www.jacoco.org/jacoco/)（EPL-2.0许可证）二次开发。  
- 新增闭源功能（如IP划分等）需付费授权，开源部分遵循EPL-2.0许可证。  
```
